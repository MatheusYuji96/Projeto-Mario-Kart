<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon2.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projeto Mario Kart | Simulador</title>


    <link rel="stylesheet" href="./../css/dashboards.css">
    <link rel="stylesheet" href="./../css/estilo.css" />

    <script src="../js/sessao.js"></script>
    <script src="../js/alerta.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
</head>

<body onload="validarSessao(), exibirSimulador(),  atualizacaoPeriodica()">


    <div class="header-left dash-header">

        <h1>Projeto Mario Kart</h1>

        <div class="hello">
            <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
        </div>

        <div class="btn-nav">
            <h3>Simulador</h3>
        </div>

        <div class="btn-nav-white">
            <a href="./dashboard.html">
                <h3>Dashboard</h3>
            </a>
        </div>

        <!--<div class="btn-nav-white">
            <a href="./mural.html">
                <h3>Mural de Avisos</h3>
            </a>
        </div>-->

        <div class="btn-logout" onclick="limparSessao()">
            <h3>Sair</h3>
        </div>
    </div>
    <div class="janela-card">

        <!-- simulador inicio -->
        <div class="simulador">
            <div class="container1">
                <h1>Simulador</h1>
                <h3>Vamos lá!! Quer imaginar como funciona uma competição em Mario Kart? Então vamos brincar neste
                    simulador de torneio!!<br><br>Como ele funciona: Você digitará seu nome, escolherá um piloto e a quantidade de corridas. Cada corrida possui uma pontuação que varia de 1 a 15 e os pontos dos jogadores serão gerados aleatoriamente.<br><br>Após clicar em "Definir Pontuação", um botão para os famosos itens de trapaça de Mario Kart aparecerá. E dependendo da sua sorte, os itens irão ou não reduzir sua pontuação. O vencedor será aquele que obtiver a maior quantidade de pontos ao final. Boa sorte!!</h3><br><br>
                <div class="simula" id="simcorrida" style="display: block;">
                    <span>Quais os Nomes dos Jogadores?</span><br><br>
                    <span>Jogador 1: </span><input type="text" id="iptNome1">
                    <div id="msgjogador1"></div><br><br>
                    <span>Jogador 2: </span><input type="text" id="iptNome2">
                    <div id="msgjogador2"></div><br><br>
                    <span>Quantas corridas?</span> <br><br><input type="number" id="iptNumCor" min="3" max="12">
                    <div id="msgnumcor"></div><br><br>
                    <span>Jogador 1: Escolha o piloto:</span> <select id="piloto1">
                        <option value="#">Selecione</option>
                        <option value="Mario">Mario</option>
                        <option value="Luigi">Luigi</option>
                        <option value="Yoshi">Yoshi</option>
                        <option value="Peach">Peach</option>
                        <option value="Bowser">Bowser</option>
                    </select>
                    <div id="msgpiloto1"></div><br><br>
                    <span>Jogador 2: Escolha o piloto:</span> <select id="piloto2">
                        <option value="#">Selecione</option>
                        <option value="Mario">Mario</option>
                        <option value="Luigi">Luigi</option>
                        <option value="Yoshi">Yoshi</option>
                        <option value="Peach">Peach</option>
                        <option value="Bowser">Bowser</option>
                    </select>
                    <div id="msgpiloto2"></div><br><br>
                    <span>Iniciar Competição:</span> <button onclick="sortear()">Definir Pontuação</button><br><br>
                </div>
                <div id="parcial" style="display: none;">
                    <span>Classificação Parcial:</span> <button onclick="resultParcial()">Classificação</button><br><br>
                </div>
                <div id="msgParcial"></div><br><br>
                <div id="surpresa" style="display: none;">
                    <span>ITENS!!!</span> <button onclick="risco()">Perigo!</button><br><br>
                </div>
                <div id="msgItens"></div><br><br>
                <div id="final" style="display: none;">
                    <span>Resultado Final:</span> <button onclick="resultFinal()">Resultados</button><br><br>
                </div>
                <div id="mensagem"></div>
                <div id="volta" style="display: none;"><br><br>
                    <button onclick="voltar()">Voltar</button>
                </div>
            </div>
        </div>
        <!-- simulador fim -->

</body>
<script>
    let P1 = [];
    let P2 = [];
    let PontFinal1 = 0;
    let PontFinal2 = 0;
    var Rodada = 0;
    let VitoriaP1 = 0;
    let VitoriaP2 = 0;
    function sortear() {
        let nome1 = iptNome1.value;
        let nome2 = iptNome2.value;
        console.log(nome1)
        console.log(nome2)
        let nomepiloto1 = piloto1.value;
        let nomepiloto2 = piloto2.value;
        let numCor = Number(iptNumCor.value);
        if (iptNome1.value == '' && iptNome2.value == '') {
            msgjogador1.innerHTML = `Insira o nome do jogador 1`
            msgjogador2.innerHTML = `Insira o nome do jogador 2`
        } else if (iptNome1.value == '') {
            msgjogador1.innerHTML = `Insira o nome do jogador 1`
        } else if (iptNome2.value == '') {
            msgjogador2.innerHTML = `Insira o nome do jogador 2`
        }
        if (piloto1.value == '#' && piloto2.value == '#') {
            msgpiloto1.innerHTML = `Escolha um piloto dentre as opções`
            msgpiloto2.innerHTML = `Escolha um piloto dentre as opções`
        } else if (piloto1.value == '#') {
            msgpiloto1.innerHTML = `Escolha um piloto dentre as opções`
        } else if (piloto2.value == '#') {
            msgpiloto2.innerHTML = `Escolha um piloto dentre as opções`
        }
        if (iptNumCor.value == '' || numCor <= 2 || numCor > 12 || numCor % 1 != 0) {
            msgnumcor.innerHTML = `Escolha um número de corridas inteiro e entre 3 e 12`
        } else {
            for (let sequencia = 0; sequencia < numCor; sequencia++) {
                let sorteio1 = Math.random()
                P1.push(Number((sorteio1 * 14 + 1).toFixed(0)));
                let sorteio2 = Math.random()
                P2.push(Number((sorteio2 * 14 + 1).toFixed(0)));
            }
        }
        simcorrida.style.display = 'none';
        parcial.style.display = 'block';
        Rodada++
    }
    function resultParcial() {
        let nome1 = iptNome1.value;
        let nome2 = iptNome2.value;
        let nomepiloto1 = piloto1.value;
        let nomepiloto2 = piloto2.value;
        let sequencia = 0;
        while (sequencia < P1.length) {
            PontFinal1 = PontFinal1 + P1[sequencia];
            PontFinal2 = PontFinal2 + P2[sequencia];
            sequencia++
        }
        msgParcial.innerHTML = `<b>${nome1}</b>, controlando <b>${nomepiloto1}</b>, obteve os seguintes pontos nas corridas: ${P1}<br>Somatório parcial dos pontos: <b>${PontFinal1} pontos</b><br><br><b>${nome2}</b>, controlando <b>${nomepiloto2}</b>, obteve os seguintes pontos nas corridas: ${P2}<br>Somatório parcial dos pontos: <b>${PontFinal2} pontos</b>`
        surpresa.style.display = 'block';
        parcial.style.display = 'none';
    }
    function risco() {
        let nome1 = iptNome1.value;
        let nome2 = iptNome2.value;
        let sorteioRisco1 = Math.random()
        if ((sorteioRisco1 * 9 + 1).toFixed(0) == 1) {
            PontFinal1 = PontFinal1 - (Number(sorteioRisco1 * 9 + 1).toFixed(0)) * 2
            msgItens.innerHTML = `<b>${nome1}</b>: Você escorregou na casca de banana e perdeu 2 pontos<br><br>`
        } else if ((sorteioRisco1 * 9 + 1).toFixed(0) == 2) {
            PontFinal1 = PontFinal1 - (Number(sorteioRisco1 * 9 + 1).toFixed(0)) * 2
            msgItens.innerHTML = `<b>${nome1}</b>: Você levou dano de um casco verde e perdeu 4 pontos<br><br>`
        } else if ((sorteioRisco1 * 9 + 1).toFixed(0) == 3) {
            PontFinal1 = PontFinal1 - (Number(sorteioRisco1 * 9 + 1).toFixed(0)) * 2
            msgItens.innerHTML = `<b>${nome1}</b>: Você levou dano de um casco vermelho e perdeu 6 pontos<br><br>`
        } else if ((sorteioRisco1 * 9 + 1).toFixed(0) == 5) {
            PontFinal1 = PontFinal1 - (Number(sorteioRisco1 * 9 + 1).toFixed(0)) * 2
            msgItens.innerHTML = `<b>${nome1}</b>: Você foi explodido por uma Bob-omb e perdeu 10 pontos<br><br>`
        } else if ((sorteioRisco1 * 9 + 1).toFixed(0) == 8) {
            PontFinal1 = PontFinal1 - (Number(sorteioRisco1 * 9 + 1).toFixed(0)) * 2
            msgItens.innerHTML = `<b>${nome1}</b>: Você levou choque de um raio e perdeu 16 pontos<br><br>`
        } else if ((sorteioRisco1 * 9 + 1).toFixed(0) == 10) {
            PontFinal1 = PontFinal1 - (Number(sorteioRisco1 * 9 + 1).toFixed(0)) * 2
            msgItens.innerHTML = `<b>${nome1}</b>: Você levou um casco azul na cabeça e perdeu 20 pontos<br><br>`
        } else {
            msgItens.innerHTML = `<b>${nome1}</b>: Você passou ileso pelos itens e não perdeu pontos<br><br>`
        }
        let sorteioRisco2 = Math.random()
        if ((sorteioRisco2 * 9 + 1).toFixed(0) == 1) {
            PontFinal2 = PontFinal2 - (Number(sorteioRisco2 * 9 + 1).toFixed(0)) * 2
            msgItens.innerHTML += `<b>${nome2}</b>: Você escorregou na casca de banana e perdeu 2 pontos`
        } else if ((sorteioRisco2 * 9 + 1).toFixed(0) == 2) {
            PontFinal2 = PontFinal2 - (Number(sorteioRisco2 * 9 + 1).toFixed(0)) * 2
            msgItens.innerHTML += `<b>${nome2}</b>: Você levou dano de um casco verde e perdeu 4 pontos`
        } else if ((sorteioRisco2 * 9 + 1).toFixed(0) == 3) {
            PontFinal2 = PontFinal2 - (Number(sorteioRisco2 * 9 + 1).toFixed(0)) * 2
            msgItens.innerHTML += `<b>${nome2}</b>: Você levou dano de um casco vermelho e perdeu 6 pontos`
        } else if ((sorteioRisco2 * 9 + 1).toFixed(0) == 5) {
            PontFinal2 = PontFinal2 - (Number(sorteioRisco2 * 9 + 1).toFixed(0)) * 2
            msgItens.innerHTML += `<b>${nome2}</b>: Você foi explodido por uma Bob-omb e perdeu 10 pontos`
        } else if ((sorteioRisco2 * 9 + 1).toFixed(0) == 8) {
            PontFinal2 = PontFinal2 - (Number(sorteioRisco2 * 9 + 1).toFixed(0)) * 2
            msgItens.innerHTML += `<b>${nome2}</b>: Você levou choque de um raio e perdeu 16 pontos`
        } else if ((sorteioRisco2 * 9 + 1).toFixed(0) == 10) {
            PontFinal2 = PontFinal2 - (Number(sorteioRisco2 * 9 + 1).toFixed(0)) * 2
            msgItens.innerHTML += `<b>${nome2}</b>: Você levou um casco azul na cabeça e perdeu 20 pontos`
        } else {
            msgItens.innerHTML += `<b>${nome2}</b>: Você passou ileso pelos itens e não perdeu pontos`
        }
        final.style.display = 'block';
        surpresa.style.display = 'none';
    }
    function resultFinal() {
        let nome1 = iptNome1.value;
        let nome2 = iptNome2.value;
        if (PontFinal1 > PontFinal2) {
            mensagem.innerHTML = `<b>Parabéns, ${nome1}!! Você venceu a competição!!</b>`
            VitoriaP1++
        } else if (PontFinal2 > PontFinal1) {
            mensagem.innerHTML = `<b>Parabéns, ${nome2}!! Você venceu a competição!!</b>`
            VitoriaP2++
        } else if (PontFinal1 == PontFinal2) {
            mensagem.innerHTML = `Temos um EMPATEEE!!`
        }
        mensagem.innerHTML += `<br><br><b>Resultados Finais: ${nome1} = ${PontFinal1} pontos<br><br>${nome2} = ${PontFinal2} pontos</b>`
        console.log(PontFinal1)
        console.log(PontFinal2)
        console.log(Rodada)
        fetch("/resultados/cadastrar", {
            method: "post",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                PontFinal1: PontFinal1,
                PontFinal2: PontFinal2,
                VitoriaP1: VitoriaP1,
                VitoriaP2: VitoriaP2,
                ceUsuario: sessionStorage.ID_USUARIO
            })
        }).then(function (resposta) {
            console.log("resposta: ", resposta);
            if (resposta.ok) {
                console.log("Dados de PontFinal1, PontFinal2, VitoriaP1, VitoriaP2 e ceUsuario guardados com sucesso")
            } else {
                console.log(`Problemas no armazenamento. Verificar.`);
            }
        })
        P1 = [];
        P2 = [];
        PontFinal1 = PontFinal1 * 0;
        PontFinal2 = PontFinal2 * 0;
        console.log(VitoriaP1)
        console.log(VitoriaP2)
        final.style.display = 'none';
        volta.style.display = 'block';
        iptNome1.value = '';
        iptNome2.value = '';
        piloto1.value = '#';
        piloto2.value = '#';
        iptNumCor.value = '';
    }
    function voltar(){
        msgParcial.innerHTML = '';
        msgItens.innerHTML = '';
        mensagem.innerHTML = '';
        simcorrida.style.display = 'block';
        parcial.style.display = 'none';
        surpresa.style.display = 'none';
        final.style.display = 'none';
        volta.style.display = 'none';
    }
</script>

</html>